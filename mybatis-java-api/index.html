<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyBatis Java API | Java技术天地</title><meta name="description" content="MyBatis Java API"><meta name="keywords" content="Java,MyBatis,MyBatis基础教程"><meta name="author" content="Java技术天地"><meta name="copyright" content="Java技术天地"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon-32x32.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MyBatis Java API"><meta name="twitter:description" content="MyBatis Java API"><meta name="twitter:image" content="https://www.zzwzdx.cn/img/avatar.png"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis Java API"><meta property="og:url" content="https://www.zzwzdx.cn/mybatis-java-api/"><meta property="og:site_name" content="Java技术天地"><meta property="og:description" content="MyBatis Java API"><meta property="og:image" content="https://www.zzwzdx.cn/img/avatar.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode="1",t=Cookies.get("theme");if("1"==autoChangeMode){var isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,isLightMode=window.matchMedia("(prefers-color-scheme: light)").matches,isNotSpecified=window.matchMedia("(prefers-color-scheme: no-preference)").matches,hasNoSupport=!isDarkMode&&!isLightMode&&!isNotSpecified;if(void 0===t){if(isLightMode)activateLightMode();else if(isDarkMode)activateDarkMode();else if(isNotSpecified||hasNoSupport){console.log("You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.");var now=new Date,hour=now.getHours(),isNight=hour<6||18<=hour;isNight?activateDarkMode():activateLightMode()}}else"light"==t?activateLightMode():activateDarkMode()}else"2"==autoChangeMode?(isNight=(hour=(now=new Date).getHours())<6||18<=hour,void 0===t?isNight?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode()):"dark"==t?activateDarkMode():"light"==t&&activateLightMode();function activateDarkMode(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#000")}function activateLightMode(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#fff")}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://www.zzwzdx.cn/mybatis-java-api/"><link rel="prev" title="MyBatis SQL语句构建器" href="https://www.zzwzdx.cn/mybatis-sql-statement-builder/"><link rel="next" title="MyBatis 动态SQL" href="https://www.zzwzdx.cn/mybatis-dynamic-sql/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6cdf806ea3d36641644ddfae3f9e80cb";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},translate:{defaultEncoding:2,translateDelay:0,cookieDomain:"https://www.zzwzdx.cn/",msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},bookmark:{message_prev:"按",message_next:"键将本页加入书签"},runtime_unit:"天",runtime:!0,copyright:{languages:{author:"作者: Java技术天地",link:"链接: ",source:"来源: Java技术天地",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},ClickShowText:void 0,medium_zoom:!1,fancybox:!0,Snackbar:{bookmark:{message_prev:"按",message_next:"键将本页加入书签"},chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#2d3035",position:"top-center"},baiduPush:!1,highlightCopy:!0,highlightLang:!0,highlightShrink:"false",isFontAwesomeV5:!1,isPhotoFigcaption:!1}</script><script>var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isSidebar:!1}</script><noscript><style>#page-header{opacity:1}.justified-gallery img{opacity:1}</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">65</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/" aria-current="page"><i class="fa-fw fa fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/juc/" aria-current="page"><i class="fa-fw fa fa-lock"></i> <span>Java并发</span></a></div><div class="menus_item"><a class="site-page" href="/spring-ioc/" aria-current="page"><i class="fa-fw fa fa-eercast"></i> <span>Spring IOC专题</span></a></div><div class="menus_item"><a class="site-page" href="/dp/" aria-current="page"><i class="fa-fw fa fa-ge"></i> <span>设计模式</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-meetup" aria-hidden="true"></i> <span>Mybatis教程</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/mybatis3/"><i class="fa-fw fa fa-anchor"></i> <span>Mybatis基础教程</span></a></li><li><a class="site-page" href="/mybatis3-source/"><i class="fa-fw fa fa-asterisk"></i> <span>Mybatis源码分析</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/" aria-current="page"><i class="fa-fw fa fa-archive"></i> <span>归档</span></a></div></div></div></div><div class="main-bg" id="body-wrap"><div class="post-bg" id="nav"><div id="page-header"><a class="pull_left" id="blog_name" href="/"><i class="logo"></i><span class="blog_title" id="site-name">Java技术天地</span></a><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/" aria-current="page"><i class="fa-fw fa fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/juc/" aria-current="page"><i class="fa-fw fa fa-lock"></i> <span>Java并发</span></a></div><div class="menus_item"><a class="site-page" href="/spring-ioc/" aria-current="page"><i class="fa-fw fa fa-eercast"></i> <span>Spring IOC专题</span></a></div><div class="menus_item"><a class="site-page" href="/dp/" aria-current="page"><i class="fa-fw fa fa-ge"></i> <span>设计模式</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-meetup" aria-hidden="true"></i> <span>Mybatis教程</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/mybatis3/"><i class="fa-fw fa fa-anchor"></i> <span>Mybatis基础教程</span></a></li><li><a class="site-page" href="/mybatis3-source/"><i class="fa-fw fa fa-asterisk"></i> <span>Mybatis源码分析</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/" aria-current="page"><i class="fa-fw fa fa-archive"></i> <span>归档</span></a></div></div><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i></a></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="post-info"><div id="post-title"><div class="posttitle">MyBatis Java API</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date" title="发表于 2019-10-15 21:58:57"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-10-15</time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/MyBatis%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" target="_blank">MyBatis基础教程</a></span><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/mybatis-java-api/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div><div id="article-container"><h2 id="Java-API"><a href="#Java-API" class="headerlink" title="Java API"></a>Java API</h2><p>既然你已经知道如何配置 MyBatis 和创建映射文件,你就已经准备好来提升技能了。 MyBatis 的 Java API 就是你收获你所做的努力的地方。正如你即将看到的,和 JDBC 相比, MyBatis 很大程度简化了你的代码而且保持简洁,很容易理解和维护。MyBatis 3 已经引入 了很多重要的改进来使得 SQL 映射更加优秀。</p><h2 id="应用目录结构"><a href="#应用目录结构" class="headerlink" title="应用目录结构"></a>应用目录结构</h2><p>在我们深入 Java API 之前,理解关于目录结构的最佳实践是很重要的。MyBatis 非常灵 活, 你可以用你自己的文件来做几乎所有的事情。 但是对于任一框架, 都有一些最佳的方式。</p><p>让我们看一下典型应用的目录结构:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;my_application</span><br><span class="line">  &#x2F;bin</span><br><span class="line">  &#x2F;devlib</span><br><span class="line">  &#x2F;lib                &lt;-- MyBatis *.jar文件在这里。</span><br><span class="line">  &#x2F;src</span><br><span class="line">    &#x2F;org&#x2F;myapp&#x2F;</span><br><span class="line">      &#x2F;action</span><br><span class="line">      &#x2F;data           &lt;-- MyBatis配置文件在这里, 包括映射器类, XML配置, XML映射文件。</span><br><span class="line">        &#x2F;mybatis-config.xml</span><br><span class="line">        &#x2F;BlogMapper.java</span><br><span class="line">        &#x2F;BlogMapper.xml</span><br><span class="line">      &#x2F;model</span><br><span class="line">      &#x2F;service</span><br><span class="line">      &#x2F;view</span><br><span class="line">    &#x2F;properties       &lt;-- 在你XML中配置的属性 文件在这里。</span><br><span class="line">  &#x2F;test</span><br><span class="line">    &#x2F;org&#x2F;myapp&#x2F;</span><br><span class="line">      &#x2F;action</span><br><span class="line">      &#x2F;data</span><br><span class="line">      &#x2F;model</span><br><span class="line">      &#x2F;service</span><br><span class="line">      &#x2F;view</span><br><span class="line">    &#x2F;properties</span><br><span class="line">  &#x2F;web</span><br><span class="line">    &#x2F;WEB-INF</span><br><span class="line">      &#x2F;web.xml</span><br></pre></td></tr></table></figure><p>Remember, these are preferences, not requirements, but others will thank you for using a common directory structure.</p><p>这部分内容剩余的示例将假设你使用了这种目录结构。</p><h2 id="SqlSessions"><a href="#SqlSessions" class="headerlink" title="SqlSessions"></a>SqlSessions</h2><p>使用 MyBatis 的主要 Java 接口就是 SqlSession。尽管你可以使用这个接口执行命令,获 取映射器和管理事务。我们会讨论 SqlSession 本身更多,但是首先我们还是要了解如果获取 一个 SqlSession 实例。SqlSessions 是由 SqlSessionFactory 实例创建的。SqlSessionFactory 对 象 包 含 创 建 SqlSession 实 例 的 所 有 方 法 。 而 SqlSessionFactory 本 身 是 由 SqlSessionFactoryBuilder 创建的,它可以从 XML 配置,注解或手动配置 Java 来创建 SqlSessionFactory。</p><p>NOTE When using MyBatis with a dependency injection framework like Spring or Guice, SqlSessions are created and injected by the DI framework so you don’t need to use the SqlSessionFactoryBuilder or SqlSessionFactory and can go directly to the SqlSession section. Please refer to the MyBatis-Spring or MyBatis-Guice manuals for further info.</p><h4 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h4><p>SqlSessionFactoryBuilder 有五个 build()方法,每一种都允许你从不同的资源中创建一个 SqlSession 实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SqlSessionFactory <span class="title">build</span><span class="params">(InputStream inputStream)</span></span></span><br><span class="line"><span class="function">SqlSessionFactory <span class="title">build</span><span class="params">(InputStream inputStream, String environment)</span></span></span><br><span class="line"><span class="function">SqlSessionFactory <span class="title">build</span><span class="params">(InputStream inputStream, Properties properties)</span></span></span><br><span class="line"><span class="function">SqlSessionFactory <span class="title">build</span><span class="params">(InputStream inputStream, String env, Properties props)</span></span></span><br><span class="line"><span class="function">SqlSessionFactory <span class="title">build</span><span class="params">(Configuration config)</span></span></span><br></pre></td></tr></table></figure><p>第一种方法是最常用的,它使用了一个参照了 XML 文档或上面讨论过的更特定的 mybatis-config.xml 文件的 Reader 实例。 可选的参数是 environment 和 properties。 Environment 决定加载哪种环境,包括数据源和事务管理器。比如:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"production"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"JNDI"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果你调用了 一个使用 environment 参数 方 式的 build 方法, 那么 MyBatis 将会使用 configuration 对象来配置这个 environment。 当然, 如果你指定了一个不合法的 environment, 你会得到错误提示。 如果你调用了其中之一没有 environment 参数的 build 方法, 那么就使用 默认的 environment(在上面的示例中就会指定为 default=”development”)。</p><p>如果你调用了使用 properties 实例的方法,那么 MyBatis 就会加载那些 properties(属性 配置文件) ,并你在你配置中可使用它们。那些属性可以用${propName}语法形式多次用在 配置文件中。</p><p>回想一下,属性可以从 mybatis-config.xml 中被引用,或者直接指定它。因此理解优先 级是很重要的。我们在文档前面已经提及它了,但是这里要再次重申:</p><p>如果一个属性存在于这些位置,那么 MyBatis 将会按找下面的顺序来加载它们:</p><ul><li>在 properties 元素体中指定的属性首先被读取,</li><li>从 properties 元素的类路径 resource 或 url 指定的属性第二个被读取, 可以覆盖已经 指定的重复属性,</li><li>作为方法参 数传递 的属性最 后被读 取,可以 覆盖已 经从 properties 元 素体和 resource/url 属性中加载的任意重复属性。</li></ul><p>因此,最高优先级的属性是通过方法参数传递的,之后是 resource/url 属性指定的,最 后是在 properties 元素体中指定的属性。</p><p>总结一下,前四个方法很大程度上是相同的,但是由于可以覆盖,就允许你可选地指定 environment 和/或 properties。 这里给出一个从 mybatis-config.xml 文件创建 SqlSessionFactory 的示例:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String **resource** = <span class="string">"org/mybatis/builder/mybatis-config.xml"</span>;</span><br><span class="line">InputStream **inputStream** = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactoryBuilder **builder** = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">SqlSessionFactory **factory** = builder.build(inputStream);</span><br></pre></td></tr></table></figure><p>注意这里我们使用了 Resources 工具类,这个类在 org.mybatis.io 包中。Resources 类正 如其名,会帮助你从类路径下,文件系统或一个 web URL 加载资源文件。看一下这个类的 源代码或者通过你的 IDE 来查看,就会看到一整套有用的方法。这里给出一个简表:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">URL <span class="title">getResourceURL</span><span class="params">(String resource)</span></span></span><br><span class="line"><span class="function">URL <span class="title">getResourceURL</span><span class="params">(ClassLoader loader, String resource)</span></span></span><br><span class="line"><span class="function">InputStream <span class="title">getResourceAsStream</span><span class="params">(String resource)</span></span></span><br><span class="line"><span class="function">InputStream <span class="title">getResourceAsStream</span><span class="params">(ClassLoader loader, String resource)</span></span></span><br><span class="line"><span class="function">Properties <span class="title">getResourceAsProperties</span><span class="params">(String resource)</span></span></span><br><span class="line"><span class="function">Properties <span class="title">getResourceAsProperties</span><span class="params">(ClassLoader loader, String resource)</span></span></span><br><span class="line"><span class="function">Reader <span class="title">getResourceAsReader</span><span class="params">(String resource)</span></span></span><br><span class="line"><span class="function">Reader <span class="title">getResourceAsReader</span><span class="params">(ClassLoader loader, String resource)</span></span></span><br><span class="line"><span class="function">File <span class="title">getResourceAsFile</span><span class="params">(String resource)</span></span></span><br><span class="line"><span class="function">File <span class="title">getResourceAsFile</span><span class="params">(ClassLoader loader, String resource)</span></span></span><br><span class="line"><span class="function">InputStream <span class="title">getUrlAsStream</span><span class="params">(String urlString)</span></span></span><br><span class="line"><span class="function">Reader <span class="title">getUrlAsReader</span><span class="params">(String urlString)</span></span></span><br><span class="line"><span class="function">Properties <span class="title">getUrlAsProperties</span><span class="params">(String urlString)</span></span></span><br><span class="line"><span class="function">Class <span class="title">classForName</span><span class="params">(String className)</span></span></span><br></pre></td></tr></table></figure><p>最后一个 build 方法使用了一个 Configuration 实例。configuration 类包含你可能需要了 解 SqlSessionFactory 实例的所有内容。Configuration 类对于配置的自查很有用,包含查找和 操作 SQL 映射(不推荐使用,因为应用正接收请求) 。configuration 类有所有配置的开关, 这些你已经了解了,只在 Java API 中露出来。这里有一个简单的示例,如何手动配置 configuration 实例,然后将它传递给 build()方法来创建 SqlSessionFactory。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DataSource dataSource = BaseDataTest.createBlogDataSource();</span><br><span class="line">TransactionFactory transactionFactory = <span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line"></span><br><span class="line">Environment environment = <span class="keyword">new</span> Environment(<span class="string">"development"</span>, transactionFactory, dataSource);</span><br><span class="line"></span><br><span class="line">Configuration configuration = <span class="keyword">new</span> Configuration(environment);</span><br><span class="line">configuration.setLazyLoadingEnabled(<span class="keyword">true</span>);</span><br><span class="line">configuration.setEnhancementEnabled(<span class="keyword">true</span>);</span><br><span class="line">configuration.getTypeAliasRegistry().registerAlias(Blog<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">configuration.getTypeAliasRegistry().registerAlias(Post<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">configuration.getTypeAliasRegistry().registerAlias(Author<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">configuration.addMapper(BoundBlogMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">configuration.addMapper(BoundAuthorMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">SqlSessionFactory factory = builder.build(configuration);</span><br></pre></td></tr></table></figure><p>现在你有一个 SqlSessionFactory,可以用来创建 SqlSession 实例。</p><h4 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h4><p>SqlSessionFactory 有六个方法可以用来创建 SqlSession 实例。通常来说,如何决定是你 选择下面这些方法时:</p><ul><li><strong>Transaction (事务)</strong>: 你想为 session 使用事务或者使用自动提交(通常意味着很多 数据库和/或 JDBC 驱动没有事务)?</li><li><strong>Connection (连接)</strong>: 你想 MyBatis 获得来自配置的数据源的连接还是提供你自己</li><li><strong>Execution (执行)</strong>: 你想 MyBatis 复用预处理语句和/或批量更新语句(包括插入和 删除)?</li></ul><p>重载的 openSession()方法签名设置允许你选择这些可选中的任何一个组合。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">()</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(<span class="keyword">boolean</span> autoCommit)</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(Connection connection)</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(TransactionIsolationLevel level)</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(ExecutorType execType,TransactionIsolationLevel level)</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(ExecutorType execType)</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(ExecutorType execType, <span class="keyword">boolean</span> autoCommit)</span></span></span><br><span class="line"><span class="function">SqlSession <span class="title">openSession</span><span class="params">(ExecutorType execType, Connection connection)</span></span></span><br><span class="line"><span class="function">Configuration <span class="title">getConfiguration</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>默认的 openSession()方法没有参数,它会创建有如下特性的 SqlSession:</p><ul><li>会开启一个事务(也就是不自动提交)</li><li>连接对象会从由活动环境配置的数据源实例中得到。</li><li>事务隔离级别将会使用驱动或数据源的默认设置。</li><li>预处理语句不会被复用,也不会批量处理更新。</li></ul><p>这些方法大都可以自我解释的。 开启自动提交, “true” 传递 给可选的 autoCommit 参数。 提供自定义的连接,传递一个 Connection 实例给 connection 参数。注意没有覆盖同时设置 Connection 和 autoCommit 两者的方法,因为 MyBatis 会使用当前 connection 对象提供的设 置。 MyBatis 为事务隔离级别调用使用一个 Java 枚举包装器, 称为 TransactionIsolationLevel, 否则它们按预期的方式来工作,并有 JDBC 支持的 5 级 ( NONE,READ_UNCOMMITTED,READ_COMMITTED,REPEA TABLE_READ,SERIALIZA BLE)</p><p>还有一个可能对你来说是新见到的参数,就是 ExecutorType。这个枚举类型定义了 3 个 值:</p><ul><li><code>ExecutorType.SIMPLE</code>: 这个执行器类型不做特殊的事情。它为每个语句的执行创建一个新的预处理语句。</li><li><code>ExecutorType.REUSE</code>: 这个执行器类型会复用预处理语句。</li><li><code>ExecutorType.BATCH</code>: 这个执行器会批量执行所有更新语句,如果 SELECT 在它们中间执行还会标定它们是 必须的,来保证一个简单并易于理解的行为。</li></ul><p>注意 在 SqlSessionFactory 中还有一个方法我们没有提及,就是 getConfiguration()。这 个方法会返回一个 Configuration 实例,在运行时你可以使用它来自检 MyBatis 的配置。</p><p>注意 如果你已经使用之前版本 MyBatis,你要回忆那些 session,transaction 和 batch 都是分离的。现在和以往不同了,这些都包含在 session 的范围内了。你需要处理分开处理 事务或批量操作来得到它们的效果。</p><h4 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h4><p>如上面所提到的,SqlSession 实例在 MyBatis 中是非常强大的一个类。在这里你会发现 所有执行语句的方法,提交或回滚事务,还有获取映射器实例。</p><p>在 SqlSession 类中有超过 20 个方法,所以将它们分开成易于理解的组合。</p><h5 id="语句执行方法"><a href="#语句执行方法" class="headerlink" title="语句执行方法"></a>语句执行方法</h5><p>这些方法被用来执行定义在 SQL 映射的 XML 文件中的 SELECT,INSERT,UPDA E T 和 DELETE 语句。它们都会自行解释,每一句都使用语句的 ID 属性和参数对象,参数可以 是原生类型(自动装箱或包装类) ,JavaBean,POJO 或 Map。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function">T <span class="title">selectOne</span><span class="params">(String statement, Object parameter)</span></span></span><br><span class="line"><span class="function"> List <span class="title">selectList</span><span class="params">(String statement, Object parameter)</span></span></span><br><span class="line"><span class="function"> Map <span class="title">selectMap</span><span class="params">(String statement, Object parameter, String mapKey)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(String statement, Object parameter)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(String statement, Object parameter)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">(String statement, Object parameter)</span></span></span><br></pre></td></tr></table></figure><p>selectOne 和 selectList 的不同仅仅是 selectOne 必须返回一个对象。 如果多余一个, 或者 没有返回 (或返回了 null) 那么就会抛出异常。 , 如果你不知道需要多少对象, 使用 selectList。</p><p>如果你想检查一个对象是否存在,那么最好返回统计数(0 或 1) 。因为并不是所有语句都需 要参数,这些方法都是有不同重载版本的,它们可以不需要参数对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function">T <span class="title">selectOne</span><span class="params">(String statement)</span></span></span><br><span class="line"><span class="function"> List <span class="title">selectList</span><span class="params">(String statement)</span></span></span><br><span class="line"><span class="function"> Map <span class="title">selectMap</span><span class="params">(String statement, String mapKey)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(String statement)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(String statement)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">(String statement)</span></span></span><br></pre></td></tr></table></figure><p>最后,还有查询方法的三个高级版本,它们允许你限制返回行数的范围,或者提供自定 义结果控制逻辑,这通常用于大量的数据集合。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">E</span>&gt;</span> List<span class="tag">&lt;<span class="name">E</span>&gt;</span> selectList (String statement, Object parameter, RowBounds rowBounds)</span><br><span class="line"><span class="tag">&lt;<span class="name">K,V</span>&gt;</span> Map<span class="tag">&lt;<span class="name">K,V</span>&gt;</span> selectMap(String statement, Object parameter, String mapKey, RowBounds rowbounds)</span><br><span class="line">void select (String statement, Object parameter, ResultHandler<span class="tag">&lt;<span class="name">T</span>&gt;</span> handler)</span><br><span class="line">void select (String statement, Object parameter, RowBounds rowBounds, ResultHandler<span class="tag">&lt;<span class="name">T</span>&gt;</span> handler)</span><br></pre></td></tr></table></figure><p>RowBounds 参数会告诉 MyBatis 略过指定数量的记录,还有限制返回结果的数量。 RowBounds 类有一个构造方法来接收 offset 和 limit,否则是不可改变的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> offset = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">int</span> limit = <span class="number">25</span>;</span><br><span class="line">RowBounds rowBounds = <span class="keyword">new</span> RowBounds(offset, limit);</span><br></pre></td></tr></table></figure><p>不同的驱动会实现这方面的不同级别的效率。对于最佳的表现,使用结果集类型的 SCROLL_SENSITIVE 或 SCROLL_INSENSITIVE(或句话说:不是 FORWARD_ONLY)。</p><p>ResultHandler 参数允许你按你喜欢的方式处理每一行。你可以将它添加到 List 中,创 建 Map, 或抛出每个结果而不是只保留总计。 Set 你可以使用 ResultHandler 做很多漂亮的事, 那就是 MyBatis 内部创建结果集列表。</p><p>它的接口很简单。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.ibatis.session;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultHandler</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">handleResult</span><span class="params">(ResultContext context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ResultContext 参数给你访问结果对象本身的方法, 大量结果对象被创建, 你可以使用布 尔返回值的 stop()方法来停止 MyBatis 加载更多的结果。</p><h5 id="事务控制方法"><a href="#事务控制方法" class="headerlink" title="事务控制方法"></a>事务控制方法</h5><p>控制事务范围有四个方法。 当然, 如果你已经选择了自动提交或你正在使用外部事务管 理器,这就没有任何效果了。然而,如果你正在使用 JDBC 事务管理员,由 Connection 实 例来控制,那么这四个方法就会派上用场:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">(<span class="keyword">boolean</span> force)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">(<span class="keyword">boolean</span> force)</span></span></span><br></pre></td></tr></table></figure><p>默认情况下 MyBatis 不会自动提交事务, 除非它侦测到有插入, 更新或删除操作改变了 数据库。如果你已经做出了一些改变而没有使用这些方法,那么你可以传递 true 到 commit 和 rollback 方法来保证它会被提交(注意,你不能在自动提交模式下强制 session,或者使用 了外部事务管理器时) 。很多时候你不用调用 rollback(),因为如果你没有调用 commit 时 MyBatis 会替你完成。然而,如果你需要更多对多提交和回滚都可能的 session 的细粒度控 制,你可以使用回滚选择来使它成为可能。</p><p>NOTE MyBatis-Spring and MyBatis-Guice provide declarative transaction handling. So if you are using MyBatis with Spring or Guice please refer to their specific manuals.</p><h5 id="清理-Session-级的缓存"><a href="#清理-Session-级的缓存" class="headerlink" title="清理 Session 级的缓存"></a>清理 Session 级的缓存</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clearCache</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>SqlSession 实例有一个本地缓存在执行 update,commit,rollback 和 close 时被清理。要 明确地关闭它(获取打算做更多的工作) ,你可以调用 clearCache()。</p><h5 id="确保-SqlSession-被关闭"><a href="#确保-SqlSession-被关闭" class="headerlink" title="确保 SqlSession 被关闭"></a>确保 SqlSession 被关闭</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>你必须保证的最重要的事情是你要关闭所打开的任何 session。保证做到这点的最佳方 式是下面的工作模式:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// following 3 lines pseudocod for "doing some work"</span></span><br><span class="line">    session.insert(...);</span><br><span class="line">    session.update(...);</span><br><span class="line">    session.delete(...);</span><br><span class="line">    session.commit();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Or, If you are using jdk 1.7+ and MyBatis 3.2+, you can use the try-with-resources statement:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">    <span class="comment">// following 3 lines pseudocode for "doing some work"</span></span><br><span class="line">    session.insert(...);</span><br><span class="line">    session.update(...);</span><br><span class="line">    session.delete(...);</span><br><span class="line">    session.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意 就像 SqlSessionFactory,你可以通过调用 getConfiguration()方法获得 SqlSession 使用的 Configuration 实例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Configuration <span class="title">getConfiguration</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><h5 id="使用映射器"><a href="#使用映射器" class="headerlink" title="使用映射器"></a>使用映射器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">T <span class="title">getMapper</span><span class="params">(Class type)</span></span></span><br></pre></td></tr></table></figure><p>上述的各个 insert,update,delete 和 select 方法都很强大,但也有些繁琐,没有类型安 全,对于你的 IDE 也没有帮助,还有可能的单元测试。在上面的入门章节中我们已经看到 了一个使用映射器的示例。</p><p>因此, 一个更通用的方式来执行映射语句是使用映射器类。 一个映射器类就是一个简单 的接口,其中的方法定义匹配于 SqlSession 方法。下面的示例展示了一些方法签名和它们是 如何映射到 SqlSession 的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthorMapper</span> </span>&#123;</span><br><span class="line">  <span class="comment">// (Author) selectOne("selectAuthor",5);</span></span><br><span class="line">  <span class="function">Author <span class="title">selectAuthor</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">  <span class="comment">// (List) selectList("selectAuthors")</span></span><br><span class="line">  <span class="function">List <span class="title">selectAuthors</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="comment">// (Map) selectMap("selectAuthors", "id")</span></span><br><span class="line">  <span class="meta">@MapKey</span>(<span class="string">"id"</span>)</span><br><span class="line">  <span class="function">Map <span class="title">selectAuthors</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="comment">// insert("insertAuthor", author)</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">insertAuthor</span><span class="params">(Author author)</span></span>;</span><br><span class="line">  <span class="comment">// updateAuthor("updateAuthor", author)</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">updateAuthor</span><span class="params">(Author author)</span></span>;</span><br><span class="line">  <span class="comment">// delete("deleteAuthor",5)</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">deleteAuthor</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总之, 每个映射器方法签名应该匹配相关联的 SqlSession 方法, 而没有字符串参数 ID。 相反,方法名必须匹配映射语句的 ID。</p><p>此外,返回类型必须匹配期望的结果类型。所有常用的类型都是支持的,包括:原生类 型,Map,POJO 和 JavaBean。</p><p>映射器接口不需要去实现任何接口或扩展任何类。 只要方法前面可以被用来唯一标识对 应的映射语句就可以了。</p><p>映射器接口可以扩展其他接口。当使用 XML 来构建映射器接口时要保证在合适的命名 空间中有语句。 而且, 唯一的限制就是你不能在两个继承关系的接口中有相同的方法签名 (这 也是不好的想法)。</p><p>你可以传递多个参数给一个映射器方法。 如果你这样做了, 默认情况下它们将会以它们 在参数列表中的位置来命名,比如:#{param1},#{param2}等。如果你想改变参数的名称(只在多参数 情况下) ,那么你可以在参数上使用@Param(“paramName”)注解。</p><p>你也可以给方法传递一个 RowBounds 实例来限制查询结果。</p><h5 id="映射器注解"><a href="#映射器注解" class="headerlink" title="映射器注解"></a>映射器注解</h5><p>因为最初设计时,MyBatis 是一个 XML 驱动的框架。配置信息是基于 XML 的,而且 映射语句也是定义在 XML 中的。而到了 MyBatis 3,有新的可用的选择了。MyBatis 3 构建 在基于全面而且强大的 Java 配置 API 之上。这个配置 API 是基于 XML 的 MyBatis 配置的 基础,也是新的基于注解配置的基础。注解提供了一种简单的方式来实现简单映射语句,而 不会引入大量的开销。</p><p>注意 不幸的是,Java 注解限制了它们的表现和灵活。尽管很多时间都花调查,设计和 实验上,最强大的 MyBatis 映射不能用注解来构建,那并不可笑。C#属性(做示例)就没 有这些限制,因此 MyBatis.NET 将会比 XML 有更丰富的选择。也就是说,基于 Java 注解 的配置离不开它的特性。</p><p><strong>注解有下面这些:</strong></p><table><thead><tr><th>注解</th><th>目标</th><th>相对应的 XML</th><th>描述</th></tr></thead><tbody><tr><td><code>@CacheNamespace</code></td><td><code>类</code></td><td>``</td><td>为给定的命名空间 (比如类) 配置缓存。 属性:implemetation,eviction, flushInterval,size 和 readWrite。</td></tr><tr><td><code>@CacheNamespaceRef</code></td><td><code>类</code></td><td>``</td><td>参照另外一个命名空间的缓存来使用。 属性:value,应该是一个名空间的字 符串值(也就是类的完全限定名) 。</td></tr><tr><td><code>@ConstructorArgs</code></td><td><code>Method</code></td><td>``</td><td>收集一组结果传递给一个劫夺对象的 构造方法。属性:value,是形式参数 的数组。</td></tr><tr><td><code>@Arg</code></td><td><code>方法</code></td><td></td><td>单 独 的 构 造 方 法 参 数 , 是 ConstructorArgs 集合的一部分。属性: id,column,javaType,typeHandler。 id 属性是布尔值, 来标识用于比较的属 性,和XML 元素相似。</td></tr><tr><td><code>@TypeDiscriminator</code></td><td><code>方法</code></td><td>``</td><td>一组实例值被用来决定结果映射的表 现。 属性: column, javaType, jdbcType, typeHandler,cases。cases 属性就是实 例的数组。</td></tr><tr><td><code>@Case</code></td><td><code>方法</code></td><td>``</td><td>单独实例的值和它对应的映射。属性: value,type,results。Results 属性是结 果数组,因此这个注解和实际的 ResultMap 很相似,由下面的 Results 注解指定。</td></tr><tr><td><code>@Results</code></td><td><code>方法</code></td><td>``</td><td>结果映射的列表, 包含了一个特别结果 列如何被映射到属性或字段的详情。 属 性:value,是 Result 注解的数组。</td></tr><tr><td><code>@Result</code></td><td><code>方法</code></td><td></td><td>在列和属性或字段之间的单独结果映 射。属 性:id,column, property, javaType ,jdbcType ,type Handler, one,many。id 属性是一个布尔值,表 示了应该被用于比较(和在 XML 映射 中的相似)的属性。one 属性是单 独 的 联 系, 和 相 似 , 而 many 属 性 是 对 集 合 而 言 的 , 和 相似。 它们这样命名是为了 避免名称冲突。</td></tr><tr><td><code>@One</code></td><td><code>方法</code></td><td>``</td><td>复杂类型的单独属性值映射。属性: select,已映射语句(也就是映射器方 法)的完全限定名,它可以加载合适类 型的实例。注意:联合映射在注解 API 中是不支持的。这是因为 Java 注解的 限制,不允许循环引用。<code>fetchType</code>, which supersedes the global configuration parameter<code>lazyLoadingEnabled</code> for this mapping.</td></tr><tr><td><code>@Many</code></td><td><code>方法</code></td><td>``</td><td>A mapping to a collection property of a complex type. Attributes:<code>select</code>, which is the fully qualified name of a mapped statement (i.e. mapper method) that can load a collection of instances of the appropriate types,<code>fetchType</code>, which supersedes the global configuration parameter<code>lazyLoadingEnabled</code> for this mapping. NOTE You will notice that join mapping is not supported via the Annotations API. This is due to the limitation in Java Annotations that does not allow for circular references.</td></tr><tr><td><code>@MapKey</code></td><td><code>方法</code></td><td></td><td>复 杂 类 型 的 集合 属 性 映射 。 属 性 : select,是映射语句(也就是映射器方 法)的完全限定名,它可以加载合适类 型的一组实例。注意:联合映射在 Java 注解中是不支持的。这是因为 Java 注 解的限制,不允许循环引用。</td></tr><tr><td><code>@Options</code></td><td><code>方法</code></td><td>映射语句的属性</td><td>这个注解提供访问交换和配置选项的 宽广范围, 它们通常在映射语句上作为 属性出现。 而不是将每条语句注解变复 杂,Options 注解提供连贯清晰的方式 来访问它们。属性:useCache=true , flushCache=false , resultSetType=FORWARD_ONLY , statementType=PREPARED , fetchSize=-1 , , timeout=-1 useGeneratedKeys=false , keyProperty=”id”。 理解 Java 注解是很 重要的,因为没有办法来指定”null” 作为值。因此,一旦你使用了 Options 注解,语句就受所有默认值的支配。要 注意什么样的默认值来避免不期望的 行为。</td></tr><tr><td>* <code>@Insert</code>,<code>@Update</code>, <code>@Delete</code>, <code>@Select</code></td><td><code>方法</code></td><td><code>&lt;insert&gt;</code>,<code>&lt;update&gt;</code>,<code>&lt;delete&gt;</code>,<code>&lt;select&gt;</code></td><td>这些注解中的每一个代表了执行的真 实 SQL。 它们每一个都使用字符串数组 (或单独的字符串)。如果传递的是字 符串数组, 它们由每个分隔它们的单独 空间串联起来。这就当用 Java 代码构 建 SQL 时避免了”丢失空间”的问题。 然而,如果你喜欢,也欢迎你串联单独 的字符串。属性:value,这是字符串 数组用来组成单独的 SQL 语句。</td></tr><tr><td>@InsertProvider,@UpdateProvider,@DeleteProvider,@SelectProvider</td><td>方法</td><td><code>&lt;insert&gt;</code>,<code>&lt;update&gt;</code>,<code>&lt;delete&gt;</code>,<code>&lt;select&gt;</code></td><td>这些可选的 SQL 注解允许你指定一个 类名和一个方法在执行时来返回运行 允许创建动态 的 SQL。 基于执行的映射语句, MyBatis 会实例化这个类,然后执行由 provider 指定的方法. 这个方法可以选择性的接 受参数对象作为它的唯一参数, 但是必 须只指定该参数或者没有参数。属性: type,method。type 属性是类的完全限 定名。method 是该类中的那个方法名。 注意: 这节之后是对 SelectBuilder 类的 讨论,它可以帮助你以干净,容于阅读 的方式来构建动态 SQL。</td></tr><tr><td><code>@Param</code></td><td><code>Parameter</code></td><td>N/A</td><td>如果你的映射器的方法需要多个参数, 这个注解可以被应用于映射器的方法 参数来给每个参数一个名字。否则,多 参数将会以它们的顺序位置来被命名 (不包括任何 RowBounds 参数) 比如。 #{param1} , #{param2} 等 , 这 是 默 认 的 。 使 用 @Param(“person”),参数应该被命名为 #{person}。</td></tr><tr><td><code>@SelectKey</code></td><td><code>Method</code></td><td><code>&lt;selectKey&gt;</code></td><td>This annotation duplicates the `` functionality for methods annotated with<code>@Insert</code>,<code>@InsertProvider</code>,<code>@Update</code>or<code>@UpdateProvider</code>. It is ignored for other methods. If you specify a<code>@SelectKey</code>annotation, then MyBatis will ignore any generated key properties set via the<code>@Options</code>annotation, or configuration properties. Attributes: statement an array of strings which is the SQL statement to execute,<code>keyProperty</code>which is the property of the parameter object that will be updated with the new value, before which must be either<code>true</code>or<code>false</code>to denote if the SQL statement should be executed before or after the insert,<code>resultType</code>which is the Java type of the<code>keyProperty</code>, and<code>statementType=PREPARED</code>.</td></tr><tr><td><code>@ResultMap</code></td><td><code>Method</code></td><td>N/A</td><td>This annotation is used to provide the id of a `` element in an XML mapper to a<code>@Select</code>or<code>@SelectProvider</code>annotation. This allows annotated selects to reuse resultmaps that are defined in XML. This annotation will override any<code>@Results</code>or<code>@ConstructorArgs</code> annotation if both are specified on an annotated select.</td></tr><tr><td><code>@ResultType</code></td><td><code>Method</code></td><td>N/A</td><td>This annotation is used when using a result handler. In that case, the return type is void so MyBatis must have a way to determine the type of object to construct for each row. If there is an XML result map, use the @ResultMap annotation. If the result type is specified in XML on the ` Night Mode</td></tr></tbody></table><h4 id="映射申明样例"><a href="#映射申明样例" class="headerlink" title="映射申明样例"></a>映射申明样例</h4><p>这个例子展示了如何使用 @SelectKey 注解来在插入前读取数据库序列的值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"insert into table3 (id, name) values(#&#123;nameId&#125;, #&#123;name&#125;)"</span>)</span><br><span class="line"><span class="meta">@SelectKey</span>(statement=<span class="string">"call next value for TestSequence"</span>, keyProperty=<span class="string">"nameId"</span>, before=<span class="keyword">true</span>, resultType=<span class="keyword">int</span><span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">int</span> <span class="title">insertTable3</span>(<span class="title">Name</span> <span class="title">name</span>)</span>;</span><br></pre></td></tr></table></figure><p>这个例子展示了如何使用 @SelectKey 注解来在插入后读取数据库识别列的值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"insert into table2 (name) values(#&#123;name&#125;)"</span>)</span><br><span class="line"><span class="meta">@SelectKey</span>(statement=<span class="string">"call identity()"</span>, keyProperty=<span class="string">"nameId"</span>, before=<span class="keyword">false</span>, resultType=<span class="keyword">int</span><span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">int</span> <span class="title">insertTable2</span>(<span class="title">Name</span> <span class="title">name</span>)</span>;</span><br></pre></td></tr></table></figure><blockquote><p>作者:W3Cschool<br>来源:<a href="https://www.w3cschool.cn/mybatis/ud8n1im1.html" target="_blank" rel="external nofollow noopener noreferrer">https://www.w3cschool.cn/mybatis/ud8n1im1.html</a></p></blockquote></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noopener noreferrer" target="_blank">Java技术天地</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://www.zzwzdx.cn/mybatis-java-api/">https://www.zzwzdx.cn/mybatis-java-api/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external nofollow noopener noreferrer">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.zzwzdx.cn" target="_blank">Java技术天地</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/" target="_blank">Java</a><a class="post-meta__tags" href="/tags/MyBatis/" target="_blank">MyBatis</a><a class="post-meta__tags" href="/tags/MyBatis%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" target="_blank">MyBatis基础教程</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/pay-wechat.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/pay-alipay.png" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/mybatis-sql-statement-builder/"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MyBatis SQL语句构建器</div></div></a></div><div class="next-post pull_right"><a href="/mybatis-dynamic-sql/"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MyBatis 动态SQL</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i> <span>相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/mybatis-xml-configuration/" title="MyBatis XML配置"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-12</div><div class="relatedPosts_title">MyBatis XML配置</div></div></a></div><div class="relatedPosts_item"><a href="/mybatis-xml-mapping/" title="MyBatis XML映射文件"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-13</div><div class="relatedPosts_title">MyBatis XML映射文件</div></div></a></div><div class="relatedPosts_item"><a href="/mybatis-dynamic-sql/" title="MyBatis 动态SQL"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-14</div><div class="relatedPosts_title">MyBatis 动态SQL</div></div></a></div><div class="relatedPosts_item"><a href="/mybatis-log/" title="MyBatis 日志"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-17</div><div class="relatedPosts_title">MyBatis 日志</div></div></a></div><div class="relatedPosts_item"><a href="/mybatis-sql-statement-builder/" title="MyBatis SQL语句构建器"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-16</div><div class="relatedPosts_title">MyBatis SQL语句构建器</div></div></a></div><div class="relatedPosts_item"><a href="/java-thread/" title="Java线程概念理解"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-09</div><div class="relatedPosts_title">Java线程概念理解</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container"></div><script>var gitalk=new Gitalk({clientID:"7cba1dad1cf41bf40ba9",clientSecret:"5d208277d004b840b5b67a31ebbf6aeb80a7a901",repo:"gitalk",owner:"zhangzwd",admin:["zhangzwd"],id:md5(decodeURI(location.pathname)),language:"zh-CN",perPage:10,distractionFreeMode:!0,pagerDirection:"last",createIssueManually:!1,updateCountCallback:commentCount});function commentCount(e){try{document.getElementsByClassName("gitalk-comment-count")[0].innerHTML=e}catch(e){return!1}}gitalk.render("gitalk-container")</script></div></article><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar"><div class="left-col"><img src="/img/wechat-qcode.png"></div><div class="rght-col"><h2>关注公众号</h2><small><div>→「技术干货」每日推送</div><div>→「免费资料」随时领取</div><div>→「每月赠书」抽奖活动</div></small></div></div><div class="wechat-img"><a href="/img/wdewm.jpg" target="_blank">点击添加为微信,加入讨论技术群</a></div><div class="social-desc">除公众号以外，我还会在以下平台发布内容：</div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zhangzwd" target="_blank" title="Github" rel="external nofollow noopener noreferrer"><img src="/img/github.svg"></a><a class="social-icon" href="https://gitee.com/zhangzwd" target="_blank" title="Gitee" rel="external nofollow noopener noreferrer"><img src="/img/gitee.svg"></a><a class="social-icon" href="https://www.zhihu.com/people/zhangzhengwei/activities" target="_blank" title="知乎" rel="external nofollow noopener noreferrer"><img src="/img/zhihu.svg"></a><a class="social-icon" href="https://blog.csdn.net/zhang199091" target="_blank" title="CSDN" rel="external nofollow noopener noreferrer"><img src="/img/CSDN.svg"></a><a class="social-icon" href="https://www.jianshu.com/u/44dfb2efe2f6" target="_blank" title="简书" rel="external nofollow noopener noreferrer"><img src="/img/JianShu.svg"></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fa fa-bullhorn card-announcement-animation" aria-hidden="true"></i><span>公告</span></div><div class="announcement_content">感谢访问本站，如喜欢清收藏 ^_^<div class="card-info-bookmark is-center"><a class="bookmark button--primary button--animated" id="bookmark-it" href="javascript:;" title="加入书签" target="_self"><i class="fa fa-bookmark" aria-hidden="true"></i><span>加入书签</span></a></div></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fa fa-history" aria-hidden="true"></i><span>最新文章</span></div><div class="aside-recent-item"><div class="aside-recent-post"><a href="/mybatis3-finish/" target="_blank"><div class="aside-post-title"><div class="aside-post_title" href="/mybatis3-finish/" target="_blank" title="Mybatis3源码分析之总结">Mybatis3源码分析之总结</div><time class="aside-post_meta post-meta__date" title="发表于 2021-05-11 16:30:47">2021-05-11</time></div></a></div><div class="aside-recent-post"><a href="/mybatis3-mapper-dynamic-proxy/" target="_blank"><div class="aside-post-title"><div class="aside-post_title" href="/mybatis3-mapper-dynamic-proxy/" target="_blank" title="Mybatis3源码分析之Mapper动态代理">Mybatis3源码分析之Mapper动态代理</div><time class="aside-post_meta post-meta__date" title="发表于 2021-05-11 16:10:47">2021-05-11</time></div></a></div><div class="aside-recent-post"><a href="/mybatis3-mapper-implementation/" target="_blank"><div class="aside-post-title"><div class="aside-post_title" href="/mybatis3-mapper-implementation/" target="_blank" title="Mybatis3源码分析之Mapper实现">Mybatis3源码分析之Mapper实现</div><time class="aside-post_meta post-meta__date" title="发表于 2021-05-11 16:00:47">2021-05-11</time></div></a></div><div class="aside-recent-post"><a href="/mybatis3-mapper-generation/" target="_blank"><div class="aside-post-title"><div class="aside-post_title" href="/mybatis3-mapper-generation/" target="_blank" title="Mybatis3源码分析之Mapper生成过程">Mybatis3源码分析之Mapper生成过程</div><time class="aside-post_meta post-meta__date" title="发表于 2021-05-11 15:55:47">2021-05-11</time></div></a></div><div class="aside-recent-post"><a href="/mybatis3-plug/" target="_blank"><div class="aside-post-title"><div class="aside-post_title" href="/mybatis3-plug/" target="_blank" title="Mybatis3源码分析之插件解析">Mybatis3源码分析之插件解析</div><time class="aside-post_meta post-meta__date" title="发表于 2021-05-11 15:50:47">2021-05-11</time></div></a></div></div></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Java技术天地</div><div class="icp"><a href="http://www.beian.miit.gov.cn" target="_blank" rel="external nofollow noopener noreferrer"><img class="icp-icon" src="/img/icp.png"><span>鄂ICP备19013195号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments"></i></a><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="external nofollow noopener noreferrer" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><script src="https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){pangu.spacingElementById("content-inner")})</script><script src="/js/search/local-search.js"></script></body></html>